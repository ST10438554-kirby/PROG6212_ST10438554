// MainWindow.xaml

<Window x:Class="CMCS_WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Contract Monthly Claim System" Height="650" Width="900">
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <!-- Lecturer Submission -->
        <GroupBox Header="Lecturer Claim Submission" Grid.Column="0" Margin="5">
            <StackPanel Margin="10">
                <Grid Margin="0,0,0,5">
                    <TextBox x:Name="LecturerTextBox" Height="30"/>
                    <TextBlock Text="Lecturer Name" Foreground="Gray" Margin="5,5,0,0" IsHitTestVisible="False" x:Name="LecturerPlaceholder"/>
                </Grid>

                <Grid Margin="0,0,0,5">
                    <TextBox x:Name="HoursTextBox" Height="30"/>
                    <TextBlock Text="Hours Worked" Foreground="Gray" Margin="5,5,0,0" IsHitTestVisible="False" x:Name="HoursPlaceholder"/>
                </Grid>

                <Grid Margin="0,0,0,10">
                    <TextBox x:Name="RateTextBox" Height="30"/>
                    <TextBlock Text="Hourly Rate" Foreground="Gray" Margin="5,5,0,0" IsHitTestVisible="False" x:Name="RatePlaceholder"/>
                </Grid>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Button Content="Upload Document" Click="UploadDocument_Click" Width="120"/>
                    <TextBlock x:Name="DocumentTextBlock" Margin="10,5,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <Button Content="Submit Claim" Click="SubmitClaim_Click" Background="#FF5DADE2" Height="35"/>
            </StackPanel>
        </GroupBox>

        <!-- Coordinator/Manager + HR -->
        <GroupBox Header="Claims Dashboard" Grid.Column="1" Margin="5">
            <StackPanel Margin="10">
                <DataGrid x:Name="ClaimsDataGrid" AutoGenerateColumns="False" Height="400" ItemsSource="{Binding Claims}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Lecturer" Binding="{Binding LecturerName}" Width="*" />
                        <DataGridTextColumn Header="Hours" Binding="{Binding HoursWorked}" Width="*" />
                        <DataGridTextColumn Header="Rate" Binding="{Binding HourlyRate}" Width="*" />
                        <DataGridTextColumn Header="Amount" Binding="{Binding ClaimAmount}" Width="*" />
                        <DataGridTextColumn Header="Document" Binding="{Binding DocumentName}" Width="*" />
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*" />
                        <DataGridTemplateColumn Header="Actions" Width="150">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="Approve" Click="Approve_Click" Margin="2"/>
                                        <Button Content="Reject" Click="Reject_Click" Margin="2"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <Button Content="Generate HR Report" Click="GenerateReport_Click" Background="#FF58D68D" Height="35" Margin="0,10,0,0"/>
                <TextBlock x:Name="ReportTextBlock" Margin="0,5,0,0" TextWrapping="Wrap"/>
            </StackPanel>
        </GroupBox>
    </Grid>
</Window>

  // MainWindow.xaml.cs

  using Microsoft.Win32;
using System.Collections.ObjectModel;
using System.Linq;
using System.Windows;
using System.Windows.Controls;

namespace CMCS_WPF
{
    public partial class MainWindow : Window
    {
        public ObservableCollection<Claim> Claims { get; set; } = new ObservableCollection<Claim>();
        private string uploadedDocument = "";

        public MainWindow()
        {
            InitializeComponent();
            DataContext = this;

            // Setup placeholders
            SetupPlaceholder(LecturerTextBox, LecturerPlaceholder);
            SetupPlaceholder(HoursTextBox, HoursPlaceholder);
            SetupPlaceholder(RateTextBox, RatePlaceholder);
        }

        private void SetupPlaceholder(TextBox textBox, TextBlock placeholder)
        {
            textBox.TextChanged += (s, e) =>
            {
                placeholder.Visibility = string.IsNullOrWhiteSpace(textBox.Text) ? Visibility.Visible : Visibility.Hidden;
            };
        }

        private void UploadDocument_Click(object sender, RoutedEventArgs e)
        {
            OpenFileDialog dlg = new OpenFileDialog
            {
                Filter = "PDF, DOCX, XLSX Files|*.pdf;*.docx;*.xlsx",
                Multiselect = false
            };
            if (dlg.ShowDialog() == true)
            {
                uploadedDocument = dlg.SafeFileName;
                DocumentTextBlock.Text = uploadedDocument;
            }
        }

        private void SubmitClaim_Click(object sender, RoutedEventArgs e)
        {
            if (string.IsNullOrWhiteSpace(LecturerTextBox.Text))
            {
                MessageBox.Show("Enter lecturer name.");
                return;
            }
            if (!double.TryParse(HoursTextBox.Text, out double hours) || hours <= 0)
            {
                MessageBox.Show("Enter valid hours worked.");
                return;
            }
            if (!double.TryParse(RateTextBox.Text, out double rate) || rate <= 0)
            {
                MessageBox.Show("Enter valid hourly rate.");
                return;
            }
            if (string.IsNullOrWhiteSpace(uploadedDocument))
            {
                MessageBox.Show("Upload at least one document.");
                return;
            }

            // Automated validation criteria (example)
            string status = "Pending";
            if (hours > 160)
            {
                status = "Pending Review";
            }
            else if (rate > 500)
            {
                status = "Pending Review";
            }

            Claims.Add(new Claim
            {
                LecturerName = LecturerTextBox.Text,
                HoursWorked = hours,
                HourlyRate = rate,
                ClaimAmount = hours * rate,
                Status = status,
                DocumentName = uploadedDocument
            });

            MessageBox.Show("Claim submitted successfully!");

            LecturerTextBox.Clear();
            HoursTextBox.Clear();
            RateTextBox.Clear();
            DocumentTextBlock.Text = "";
            uploadedDocument = "";
        }

        private void Approve_Click(object sender, RoutedEventArgs e)
        {
            if (ClaimsDataGrid.SelectedItem is Claim claim)
            {
                claim.Status = "Approved";
                ClaimsDataGrid.Items.Refresh();
            }
        }

        private void Reject_Click(object sender, RoutedEventArgs e)
        {
            if (ClaimsDataGrid.SelectedItem is Claim claim)
            {
                claim.Status = "Rejected";
                ClaimsDataGrid.Items.Refresh();
            }
        }

        // HR report
        private void GenerateReport_Click(object sender, RoutedEventArgs e)
        {
            var approvedClaims = Claims.Where(c => c.Status == "Approved").ToList();
            double totalPayout = approvedClaims.Sum(c => c.ClaimAmount);

            string report = "HR Report - Approved Claims:\n";
            foreach (var c in approvedClaims)
            {
                report += $"{c.LecturerName}: {c.HoursWorked} hours Ã— {c.HourlyRate} = {c.ClaimAmount}\n";
            }
            report += $"Total Payout: {totalPayout}";
            ReportTextBlock.Text = report;
        }
    }

    public class Claim
    {
        public string LecturerName { get; set; }
        public double HoursWorked { get; set; }
        public double HourlyRate { get; set; }
        public double ClaimAmount { get; set; }
        public string Status { get; set; }
        public string DocumentName { get; set; }
    }
}

